import{f as Qt,c as mt,E as Zt,a as te,N as q,T as ee,P as L,b as $,S as F,k as ne,d as C,D as re,e as Rt,F as H,g as se,h as at,w as oe,i as ie,j as ae,l as Q,s as ce,m as xt,n as le,o as de,p as ue,q as pe,r as fe,A as he,t as me,u as ge,v as ye,x as ke,y as be,z as Me,B as ve,C as jt,G as we,H as Ae,I as xe,J as Se,K as Te,L as Ee,M as Ce,R as Pe,O as Le,Q as Oe,U as $e,V as Ie,W as Be,X as He,Y as St,Z as Ne,_ as Dt,$ as Re}from"./vendor-DL2Te-ZB.js";function et(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:s}=n,{storedMarks:o}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return o},get selection(){return r},get doc(){return s},get tr(){return r=n.selection,s=n.doc,o=n.storedMarks,n}}}class nt{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:s}=n,{tr:o}=r,i=this.buildProps(o);return Object.fromEntries(Object.entries(e).map(([a,c])=>[a,(...u)=>{const d=c(...u)(i);return!o.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(o),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:s,state:o}=this,{view:i}=s,a=[],c=!!e,l=e||o.tr,u=()=>(!c&&n&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(l),a.every(p=>p===!0)),d={...Object.fromEntries(Object.entries(r).map(([p,f])=>[p,(...h)=>{const g=this.buildProps(l,n),y=f(...h)(g);return a.push(y),d}])),run:u};return d}createCan(e){const{rawCommands:n,state:r}=this,s=!1,o=e||r.tr,i=this.buildProps(o,s);return{...Object.fromEntries(Object.entries(n).map(([c,l])=>[c,(...u)=>l(...u)({...i,dispatch:void 0})])),chain:()=>this.createChain(o,s)}}buildProps(e,n=!0){const{rawCommands:r,editor:s,state:o}=this,{view:i}=s,a={tr:e,editor:s,view:i,state:et({state:o,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([c,l])=>[c,(...u)=>l(...u)(a)]))}};return a}}class je{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(s=>s.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(s=>s!==n):delete this.callbacks[e]),this}once(e,n){const r=(...s)=>{this.off(e,r),n.apply(this,s)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}}function k(t,e,n){return t.config[e]===void 0&&t.parent?k(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?k(t.parent,e,n):null}):t.config[e]}function rt(t){const e=t.filter(s=>s.type==="extension"),n=t.filter(s=>s.type==="node"),r=t.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function _t(t){const e=[],{nodeExtensions:n,markExtensions:r}=rt(t),s=[...n,...r],o={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(i=>{const a={name:i.name,options:i.options,storage:i.storage,extensions:s},c=k(i,"addGlobalAttributes",a);if(!c)return;c().forEach(u=>{u.types.forEach(d=>{Object.entries(u.attributes).forEach(([p,f])=>{e.push({type:d,name:p,attribute:{...o,...f}})})})})}),s.forEach(i=>{const a={name:i.name,options:i.options,storage:i.storage},c=k(i,"addAttributes",a);if(!c)return;const l=c();Object.entries(l).forEach(([u,d])=>{const p={...o,...d};typeof p?.default=="function"&&(p.default=p.default()),p?.isRequired&&p?.default===void 0&&delete p.default,e.push({type:i.name,name:u,attribute:p})})}),e}function x(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function A(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([s,o])=>{if(!r[s]){r[s]=o;return}if(s==="class"){const a=o?String(o).split(" "):[],c=r[s]?r[s].split(" "):[],l=a.filter(u=>!c.includes(u));r[s]=[...c,...l].join(" ")}else if(s==="style"){const a=o?o.split(";").map(u=>u.trim()).filter(Boolean):[],c=r[s]?r[s].split(";").map(u=>u.trim()).filter(Boolean):[],l=new Map;c.forEach(u=>{const[d,p]=u.split(":").map(f=>f.trim());l.set(d,p)}),a.forEach(u=>{const[d,p]=u.split(":").map(f=>f.trim());l.set(d,p)}),r[s]=Array.from(l.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else r[s]=o}),r},{})}function ut(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>A(n,r),{})}function Ft(t){return typeof t=="function"}function b(t,e=void 0,...n){return Ft(t)?e?t.bind(e)(...n):t(...n):t}function De(t={}){return Object.keys(t).length===0&&t.constructor===Object}function _e(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function Tt(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const s=e.reduce((o,i)=>{const a=i.attribute.parseHTML?i.attribute.parseHTML(n):_e(n.getAttribute(i.name));return a==null?o:{...o,[i.name]:a}},{});return{...r,...s}}}}function Et(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&De(n)?!1:n!=null))}function Fe(t,e){var n;const r=_t(t),{nodeExtensions:s,markExtensions:o}=rt(t),i=(n=s.find(l=>k(l,"topNode")))===null||n===void 0?void 0:n.name,a=Object.fromEntries(s.map(l=>{const u=r.filter(y=>y.type===l.name),d={name:l.name,options:l.options,storage:l.storage,editor:e},p=t.reduce((y,M)=>{const v=k(M,"extendNodeSchema",d);return{...y,...v?v(l):{}}},{}),f=Et({...p,content:b(k(l,"content",d)),marks:b(k(l,"marks",d)),group:b(k(l,"group",d)),inline:b(k(l,"inline",d)),atom:b(k(l,"atom",d)),selectable:b(k(l,"selectable",d)),draggable:b(k(l,"draggable",d)),code:b(k(l,"code",d)),whitespace:b(k(l,"whitespace",d)),linebreakReplacement:b(k(l,"linebreakReplacement",d)),defining:b(k(l,"defining",d)),isolating:b(k(l,"isolating",d)),attrs:Object.fromEntries(u.map(y=>{var M;return[y.name,{default:(M=y?.attribute)===null||M===void 0?void 0:M.default}]}))}),m=b(k(l,"parseHTML",d));m&&(f.parseDOM=m.map(y=>Tt(y,u)));const h=k(l,"renderHTML",d);h&&(f.toDOM=y=>h({node:y,HTMLAttributes:ut(y,u)}));const g=k(l,"renderText",d);return g&&(f.toText=g),[l.name,f]})),c=Object.fromEntries(o.map(l=>{const u=r.filter(g=>g.type===l.name),d={name:l.name,options:l.options,storage:l.storage,editor:e},p=t.reduce((g,y)=>{const M=k(y,"extendMarkSchema",d);return{...g,...M?M(l):{}}},{}),f=Et({...p,inclusive:b(k(l,"inclusive",d)),excludes:b(k(l,"excludes",d)),group:b(k(l,"group",d)),spanning:b(k(l,"spanning",d)),code:b(k(l,"code",d)),attrs:Object.fromEntries(u.map(g=>{var y;return[g.name,{default:(y=g?.attribute)===null||y===void 0?void 0:y.default}]}))}),m=b(k(l,"parseHTML",d));m&&(f.parseDOM=m.map(g=>Tt(g,u)));const h=k(l,"renderHTML",d);return h&&(f.toDOM=g=>h({mark:g,HTMLAttributes:ut(g,u)})),[l.name,f]}));return new Rt({topNode:i,nodes:a,marks:c})}function ct(t,e){return e.nodes[t]||e.marks[t]||null}function Ct(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function gt(t,e){const n=re.fromSchema(e).serializeFragment(t),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(n),s.innerHTML}const ze=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(s,o,i,a)=>{var c,l;const u=((l=(c=s.type.spec).toText)===null||l===void 0?void 0:l.call(c,{node:s,pos:o,parent:i,index:a}))||s.textContent||"%leaf%";n+=s.isAtom&&!s.isText?u:u.slice(0,Math.max(0,r-o))}),n};function yt(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class st{constructor(e){this.find=e.find,this.handler=e.handler}}const We=(t,e)=>{if(yt(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function G(t){var e;const{editor:n,from:r,to:s,text:o,rules:i,plugin:a}=t,{view:c}=n;if(c.composing)return!1;const l=c.state.doc.resolve(r);if(l.parent.type.spec.code||!((e=l.nodeBefore||l.nodeAfter)===null||e===void 0)&&e.marks.find(p=>p.type.spec.code))return!1;let u=!1;const d=ze(l)+o;return i.forEach(p=>{if(u)return;const f=We(d,p.find);if(!f)return;const m=c.state.tr,h=et({state:c.state,transaction:m}),g={from:r-(f[0].length-o.length),to:s},{commands:y,chain:M,can:v}=new nt({editor:n,state:h});p.handler({state:h,range:g,match:f,commands:y,chain:M,can:v})===null||!m.steps.length||(m.setMeta(a,{transform:m,from:r,to:s,text:o}),c.dispatch(m),u=!0)}),u}function Ke(t){const{editor:e,rules:n}=t,r=new L({state:{init(){return null},apply(s,o,i){const a=s.getMeta(r);if(a)return a;const c=s.getMeta("applyInputRules");return!!c&&setTimeout(()=>{let{text:u}=c;typeof u=="string"?u=u:u=gt(H.from(u),i.schema);const{from:d}=c,p=d+u.length;G({editor:e,from:d,to:p,text:u,rules:n,plugin:r})}),s.selectionSet||s.docChanged?null:o}},props:{handleTextInput(s,o,i,a){return G({editor:e,from:o,to:i,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:o}=s.state.selection;o&&G({editor:e,from:o.pos,to:o.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(s,o){if(o.key!=="Enter")return!1;const{$cursor:i}=s.state.selection;return i?G({editor:e,from:i.pos,to:i.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function Ue(t){return Object.prototype.toString.call(t).slice(8,-1)}function J(t){return Ue(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function ot(t,e){const n={...t};return J(t)&&J(e)&&Object.keys(e).forEach(r=>{J(e[r])&&J(t[r])?n[r]=ot(t[r],e[r]):n[r]=e[r]}),n}class O{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=b(k(this,"addOptions",{name:this.name}))),this.storage=b(k(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new O(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>ot(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new O(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=b(k(n,"addOptions",{name:n.name})),n.storage=b(k(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const i=s.marks();if(!!!i.find(l=>l?.type.name===n.name))return!1;const c=i.find(l=>l?.type.name===n.name);return c&&r.removeStoredMark(c),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}}function Ve(t){return typeof t=="number"}class qe{constructor(e){this.find=e.find,this.handler=e.handler}}const Ge=(t,e,n)=>{if(yt(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(s=>{const o=[s.text];return o.index=s.index,o.input=t,o.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),o.push(s.replaceWith)),o}):[]};function Je(t){const{editor:e,state:n,from:r,to:s,rule:o,pasteEvent:i,dropEvent:a}=t,{commands:c,chain:l,can:u}=new nt({editor:e,state:n}),d=[];return n.doc.nodesBetween(r,s,(f,m)=>{if(!f.isTextblock||f.type.spec.code)return;const h=Math.max(r,m),g=Math.min(s,m+f.content.size),y=f.textBetween(h-m,g-m,void 0,"￼");Ge(y,o.find,i).forEach(v=>{if(v.index===void 0)return;const S=h+v.index+1,w=S+v[0].length,E={from:n.tr.mapping.map(S),to:n.tr.mapping.map(w)},I=o.handler({state:n,range:E,match:v,commands:c,chain:l,can:u,pasteEvent:i,dropEvent:a});d.push(I)})}),d.every(f=>f!==null)}let X=null;const Xe=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)===null||e===void 0||e.setData("text/html",t),n};function Ye(t){const{editor:e,rules:n}=t;let r=null,s=!1,o=!1,i=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const c=({state:u,from:d,to:p,rule:f,pasteEvt:m})=>{const h=u.tr,g=et({state:u,transaction:h});if(!(!Je({editor:e,state:g,from:Math.max(d-1,0),to:p.b-1,rule:f,pasteEvent:m,dropEvent:a})||!h.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return i=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,h}};return n.map(u=>new L({view(d){const p=m=>{var h;r=!((h=d.dom.parentElement)===null||h===void 0)&&h.contains(m.target)?d.dom.parentElement:null,r&&(X=e)},f=()=>{X&&(X=null)};return window.addEventListener("dragstart",p),window.addEventListener("dragend",f),{destroy(){window.removeEventListener("dragstart",p),window.removeEventListener("dragend",f)}}},props:{handleDOMEvents:{drop:(d,p)=>{if(o=r===d.dom.parentElement,a=p,!o){const f=X;f?.isEditable&&setTimeout(()=>{const m=f.state.selection;m&&f.commands.deleteRange({from:m.from,to:m.to})},10)}return!1},paste:(d,p)=>{var f;const m=(f=p.clipboardData)===null||f===void 0?void 0:f.getData("text/html");return i=p,s=!!m?.includes("data-pm-slice"),!1}}},appendTransaction:(d,p,f)=>{const m=d[0],h=m.getMeta("uiEvent")==="paste"&&!s,g=m.getMeta("uiEvent")==="drop"&&!o,y=m.getMeta("applyPasteRules"),M=!!y;if(!h&&!g&&!M)return;if(M){let{text:w}=y;typeof w=="string"?w=w:w=gt(H.from(w),f.schema);const{from:E}=y,I=E+w.length,B=Xe(w);return c({rule:u,state:f,from:E,to:{b:I},pasteEvt:B})}const v=p.doc.content.findDiffStart(f.doc.content),S=p.doc.content.findDiffEnd(f.doc.content);if(!(!Ve(v)||!S||v===S.b))return c({rule:u,state:f,from:v,to:S,pasteEvt:i})}}))}function Qe(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}class W{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=W.resolve(e),this.schema=Fe(this.extensions,n),this.setupExtensions()}static resolve(e){const n=W.sort(W.flatten(e)),r=Qe(n.map(s=>s.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},s=k(n,"addExtensions",r);return s?[n,...this.flatten(s())]:n}).flat(10)}static sort(e){return e.sort((r,s)=>{const o=k(r,"priority")||100,i=k(s,"priority")||100;return o>i?-1:o<i?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:ct(n.name,this.schema)},s=k(n,"addCommands",r);return s?{...e,...s()}:e},{})}get plugins(){const{editor:e}=this,n=W.sort([...this.extensions].reverse()),r=[],s=[],o=n.map(i=>{const a={name:i.name,options:i.options,storage:i.storage,editor:e,type:ct(i.name,this.schema)},c=[],l=k(i,"addKeyboardShortcuts",a);let u={};if(i.type==="mark"&&k(i,"exitable",a)&&(u.ArrowRight=()=>O.handleExit({editor:e,mark:i})),l){const h=Object.fromEntries(Object.entries(l()).map(([g,y])=>[g,()=>y({editor:e})]));u={...u,...h}}const d=ne(u);c.push(d);const p=k(i,"addInputRules",a);Ct(i,e.options.enableInputRules)&&p&&r.push(...p());const f=k(i,"addPasteRules",a);Ct(i,e.options.enablePasteRules)&&f&&s.push(...f());const m=k(i,"addProseMirrorPlugins",a);if(m){const h=m();c.push(...h)}return c}).flat();return[Ke({editor:e,rules:r}),...Ye({editor:e,rules:s}),...o]}get attributes(){return _t(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=rt(this.extensions);return Object.fromEntries(n.filter(r=>!!k(r,"addNodeView")).map(r=>{const s=this.attributes.filter(c=>c.type===r.name),o={name:r.name,options:r.options,storage:r.storage,editor:e,type:x(r.name,this.schema)},i=k(r,"addNodeView",o);if(!i)return[];const a=(c,l,u,d,p)=>{const f=ut(c,s);return i()({node:c,view:l,getPos:u,decorations:d,innerDecorations:p,editor:e,extension:r,HTMLAttributes:f})};return[r.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var n;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:ct(e.name,this.schema)};e.type==="mark"&&(!((n=b(k(e,"keepOnSplit",r)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(e.name);const s=k(e,"onBeforeCreate",r),o=k(e,"onCreate",r),i=k(e,"onUpdate",r),a=k(e,"onSelectionUpdate",r),c=k(e,"onTransaction",r),l=k(e,"onFocus",r),u=k(e,"onBlur",r),d=k(e,"onDestroy",r);s&&this.editor.on("beforeCreate",s),o&&this.editor.on("create",o),i&&this.editor.on("update",i),a&&this.editor.on("selectionUpdate",a),c&&this.editor.on("transaction",c),l&&this.editor.on("focus",l),u&&this.editor.on("blur",u),d&&this.editor.on("destroy",d)})}}class T{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=b(k(this,"addOptions",{name:this.name}))),this.storage=b(k(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new T(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>ot(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new T({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=b(k(n,"addOptions",{name:n.name})),n.storage=b(k(n,"addStorage",{name:n.name,options:n.options})),n}}function zt(t,e,n){const{from:r,to:s}=e,{blockSeparator:o=`

`,textSerializers:i={}}=n||{};let a="";return t.nodesBetween(r,s,(c,l,u,d)=>{var p;c.isBlock&&l>r&&(a+=o);const f=i?.[c.type.name];if(f)return u&&(a+=f({node:c,pos:l,parent:u,index:d,range:e})),!1;c.isText&&(a+=(p=c?.text)===null||p===void 0?void 0:p.slice(Math.max(r,l)-l,s-l))}),a}function Wt(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const Ze=T.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new L({key:new $("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:s}=e,{ranges:o}=s,i=Math.min(...o.map(u=>u.$from.pos)),a=Math.max(...o.map(u=>u.$to.pos)),c=Wt(n);return zt(r,{from:i,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:c})}}})]}}),tn=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window?.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),en=(t=!1)=>({commands:e})=>e.setContent("",t),nn=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:s}=r;return n&&s.forEach(({$from:o,$to:i})=>{t.doc.nodesBetween(o.pos,i.pos,(a,c)=>{if(a.type.isText)return;const{doc:l,mapping:u}=e,d=l.resolve(u.map(c)),p=l.resolve(u.map(c+a.nodeSize)),f=d.blockRange(p);if(!f)return;const m=Ce(f);if(a.type.isTextblock){const{defaultType:h}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,h)}(m||m===0)&&e.lift(f,m)})}),!0},rn=t=>e=>t(e),sn=()=>({state:t,dispatch:e})=>Ee(t,e),on=(t,e)=>({editor:n,tr:r})=>{const{state:s}=n,o=s.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const i=r.mapping.map(e);return r.insert(i,o.content),r.setSelection(new C(r.doc.resolve(Math.max(i-1,0)))),!0},an=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const s=t.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===r.type){if(e){const a=s.before(o),c=s.after(o);t.delete(a,c).scrollIntoView()}return!0}return!1},cn=t=>({tr:e,state:n,dispatch:r})=>{const s=x(t,n.schema),o=e.selection.$anchor;for(let i=o.depth;i>0;i-=1)if(o.node(i).type===s){if(r){const c=o.before(i),l=o.after(i);e.delete(c,l).scrollIntoView()}return!0}return!1},ln=t=>({tr:e,dispatch:n})=>{const{from:r,to:s}=t;return n&&e.delete(r,s),!0},dn=()=>({state:t,dispatch:e})=>Te(t,e),un=()=>({commands:t})=>t.keyboardShortcut("Enter"),pn=()=>({state:t,dispatch:e})=>Se(t,e);function tt(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>n.strict?e[s]===t[s]:yt(e[s])?e[s].test(t[s]):e[s]===t[s]):!0}function Kt(t,e,n={}){return t.find(r=>r.type===e&&tt(Object.fromEntries(Object.keys(n).map(s=>[s,r.attrs[s]])),n))}function Pt(t,e,n={}){return!!Kt(t,e,n)}function kt(t,e,n){var r;if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if((!s.node||!s.node.marks.some(u=>u.type===e))&&(s=t.parent.childBefore(t.parentOffset)),!s.node||!s.node.marks.some(u=>u.type===e)||(n=n||((r=s.node.marks[0])===null||r===void 0?void 0:r.attrs),!Kt([...s.node.marks],e,n)))return;let i=s.index,a=t.start()+s.offset,c=i+1,l=a+s.node.nodeSize;for(;i>0&&Pt([...t.parent.child(i-1).marks],e,n);)i-=1,a-=t.parent.child(i).nodeSize;for(;c<t.parent.childCount&&Pt([...t.parent.child(c).marks],e,n);)l+=t.parent.child(c).nodeSize,c+=1;return{from:a,to:l}}function R(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const fn=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const o=R(t,r.schema),{doc:i,selection:a}=n,{$from:c,from:l,to:u}=a;if(s){const d=kt(c,o,e);if(d&&d.from<=l&&d.to>=u){const p=C.create(i,d.from,d.to);n.setSelection(p)}}return!0},hn=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function Ut(t){return t instanceof C}function _(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function Vt(t,e=null){if(!e)return null;const n=F.atStart(t),r=F.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const s=n.from,o=r.to;return e==="all"?C.create(t,_(0,s,o),_(t.content.size,s,o)):C.create(t,_(e,s,o),_(e,s,o))}function mn(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function bt(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const gn=(t=null,e={})=>({editor:n,view:r,tr:s,dispatch:o})=>{e={scrollIntoView:!0,...e};const i=()=>{(bt()||mn())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e?.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(o&&t===null&&!Ut(n.state.selection))return i(),!0;const a=Vt(s.doc,t)||n.state.selection,c=n.state.selection.eq(a);return o&&(c||s.setSelection(a),c&&s.storedMarks&&s.setStoredMarks(s.storedMarks),i()),!0},yn=(t,e)=>n=>t.every((r,s)=>e(r,{...n,index:s})),kn=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),qt=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&qt(r)}return t};function Y(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return qt(n)}function K(t,e,n){if(t instanceof se||t instanceof H)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,s=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return H.fromArray(t.map(a=>e.nodeFromJSON(a)));const i=e.nodeFromJSON(t);return n.errorOnInvalidContent&&i.check(),i}catch(o){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",o),K("",e,n)}if(s){if(n.errorOnInvalidContent){let i=!1,a="";const c=new Rt({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:l=>(i=!0,a=typeof l=="string"?l:l.outerHTML,null)}]}})});if(n.slice?at.fromSchema(c).parseSlice(Y(t),n.parseOptions):at.fromSchema(c).parse(Y(t),n.parseOptions),n.errorOnInvalidContent&&i)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const o=at.fromSchema(e);return n.slice?o.parseSlice(Y(t),n.parseOptions).content:o.parse(Y(t),n.parseOptions)}return K("",e,n)}function bn(t,e,n){const r=t.steps.length-1;if(r<e)return;const s=t.steps[r];if(!(s instanceof Pe||s instanceof Le))return;const o=t.mapping.maps[r];let i=0;o.forEach((a,c,l,u)=>{i===0&&(i=u)}),t.setSelection(F.near(t.doc.resolve(i),n))}const Mn=t=>!("type"in t),vn=(t,e,n)=>({tr:r,dispatch:s,editor:o})=>{var i;if(s){n={parseOptions:o.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const c=g=>{o.emit("contentError",{editor:o,error:g,disableCollaboration:()=>{o.storage.collaboration&&(o.storage.collaboration.isDisabled=!0)}})},l={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!o.options.enableContentCheck&&o.options.emitContentError)try{K(e,o.schema,{parseOptions:l,errorOnInvalidContent:!0})}catch(g){c(g)}try{a=K(e,o.schema,{parseOptions:l,errorOnInvalidContent:(i=n.errorOnInvalidContent)!==null&&i!==void 0?i:o.options.enableContentCheck})}catch(g){return c(g),!1}let{from:u,to:d}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},p=!0,f=!0;if((Mn(a)?a:[a]).forEach(g=>{g.check(),p=p?g.isText&&g.marks.length===0:!1,f=f?g.isBlock:!1}),u===d&&f){const{parent:g}=r.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let h;if(p){if(Array.isArray(e))h=e.map(g=>g.text||"").join("");else if(e instanceof H){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),h=g}else typeof e=="object"&&e&&e.text?h=e.text:h=e;r.insertText(h,u,d)}else h=a,r.replaceWith(u,d,h);n.updateSelection&&bn(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:u,text:h}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:u,text:h})}return!0},wn=()=>({state:t,dispatch:e})=>be(t,e),An=()=>({state:t,dispatch:e})=>Ae(t,e),xn=()=>({state:t,dispatch:e})=>xe(t,e),Sn=()=>({state:t,dispatch:e})=>we(t,e),Tn=()=>({state:t,dispatch:e,tr:n})=>{try{const r=jt(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},En=()=>({state:t,dispatch:e,tr:n})=>{try{const r=jt(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},Cn=()=>({state:t,dispatch:e})=>ve(t,e),Pn=()=>({state:t,dispatch:e})=>Me(t,e);function Gt(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function Ln(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,s,o,i;for(let a=0;a<e.length-1;a+=1){const c=e[a];if(/^(cmd|meta|m)$/i.test(c))i=!0;else if(/^a(lt)?$/i.test(c))r=!0;else if(/^(c|ctrl|control)$/i.test(c))s=!0;else if(/^s(hift)?$/i.test(c))o=!0;else if(/^mod$/i.test(c))bt()||Gt()?i=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${c}`)}return r&&(n=`Alt-${n}`),s&&(n=`Ctrl-${n}`),i&&(n=`Meta-${n}`),o&&(n=`Shift-${n}`),n}const On=t=>({editor:e,view:n,tr:r,dispatch:s})=>{const o=Ln(t).split(/-(?!$)/),i=o.find(l=>!["Alt","Ctrl","Meta","Shift"].includes(l)),a=new KeyboardEvent("keydown",{key:i==="Space"?" ":i,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),c=e.captureTransaction(()=>{n.someProp("handleKeyDown",l=>l(n,a))});return c?.steps.forEach(l=>{const u=l.map(r.mapping);u&&s&&r.maybeStep(u)}),!0};function U(t,e,n={}){const{from:r,to:s,empty:o}=t.selection,i=e?x(e,t.schema):null,a=[];t.doc.nodesBetween(r,s,(d,p)=>{if(d.isText)return;const f=Math.max(r,p),m=Math.min(s,p+d.nodeSize);a.push({node:d,from:f,to:m})});const c=s-r,l=a.filter(d=>i?i.name===d.node.type.name:!0).filter(d=>tt(d.node.attrs,n,{strict:!1}));return o?!!l.length:l.reduce((d,p)=>d+p.to-p.from,0)>=c}const $n=(t,e={})=>({state:n,dispatch:r})=>{const s=x(t,n.schema);return U(n,s,e)?ke(n,r):!1},In=()=>({state:t,dispatch:e})=>ye(t,e),Bn=t=>({state:e,dispatch:n})=>{const r=x(t,e.schema);return ge(r)(e,n)},Hn=()=>({state:t,dispatch:e})=>me(t,e);function it(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function Lt(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,s)=>(n.includes(s)||(r[s]=t[s]),r),{})}const Nn=(t,e)=>({tr:n,state:r,dispatch:s})=>{let o=null,i=null;const a=it(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(o=x(t,r.schema)),a==="mark"&&(i=R(t,r.schema)),s&&n.selection.ranges.forEach(c=>{r.doc.nodesBetween(c.$from.pos,c.$to.pos,(l,u)=>{o&&o===l.type&&n.setNodeMarkup(u,void 0,Lt(l.attrs,e)),i&&l.marks.length&&l.marks.forEach(d=>{i===d.type&&n.addMark(u,u+l.nodeSize,i.create(Lt(d.attrs,e)))})})}),!0):!1},Rn=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),jn=()=>({tr:t,dispatch:e})=>{if(e){const n=new he(t.doc);t.setSelection(n)}return!0},Dn=()=>({state:t,dispatch:e})=>fe(t,e),_n=()=>({state:t,dispatch:e})=>pe(t,e),Fn=()=>({state:t,dispatch:e})=>ue(t,e),zn=()=>({state:t,dispatch:e})=>de(t,e),Wn=()=>({state:t,dispatch:e})=>le(t,e);function pt(t,e,n={},r={}){return K(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}const Kn=(t,e=!1,n={},r={})=>({editor:s,tr:o,dispatch:i,commands:a})=>{var c,l;const{doc:u}=o;if(n.preserveWhitespace!=="full"){const d=pt(t,s.schema,n,{errorOnInvalidContent:(c=r.errorOnInvalidContent)!==null&&c!==void 0?c:s.options.enableContentCheck});return i&&o.replaceWith(0,u.content.size,d).setMeta("preventUpdate",!e),!0}return i&&o.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:u.content.size},t,{parseOptions:n,errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:s.options.enableContentCheck})};function Jt(t,e){const n=R(e,t.schema),{from:r,to:s,empty:o}=t.selection,i=[];o?(t.storedMarks&&i.push(...t.storedMarks),i.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,s,c=>{i.push(...c.marks)});const a=i.find(c=>c.type.name===n.name);return a?{...a.attrs}:{}}function Un(t,e){const n=new ee(t);return e.forEach(r=>{r.steps.forEach(s=>{n.step(s)})}),n}function Vn(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function qn(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(s,o)=>{n(s)&&r.push({node:s,pos:o})}),r}function Gn(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Mt(t){return e=>Gn(e.$from,t)}function Jn(t,e){const n={from:0,to:t.content.size};return zt(t,n,e)}function Xn(t,e){const n=x(e,t.schema),{from:r,to:s}=t.selection,o=[];t.doc.nodesBetween(r,s,a=>{o.push(a)});const i=o.reverse().find(a=>a.type.name===n.name);return i?{...i.attrs}:{}}function Xt(t,e){const n=it(typeof e=="string"?e:e.name,t.schema);return n==="node"?Xn(t,e):n==="mark"?Jt(t,e):{}}function Yn(t,e=JSON.stringify){const n={};return t.filter(r=>{const s=e(r);return Object.prototype.hasOwnProperty.call(n,s)?!1:n[s]=!0})}function Qn(t){const e=Yn(t);return e.length===1?e:e.filter((n,r)=>!e.filter((o,i)=>i!==r).some(o=>n.oldRange.from>=o.oldRange.from&&n.oldRange.to<=o.oldRange.to&&n.newRange.from>=o.newRange.from&&n.newRange.to<=o.newRange.to))}function Zn(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((s,o)=>{const i=[];if(s.ranges.length)s.forEach((a,c)=>{i.push({from:a,to:c})});else{const{from:a,to:c}=n[o];if(a===void 0||c===void 0)return;i.push({from:a,to:c})}i.forEach(({from:a,to:c})=>{const l=e.slice(o).map(a,-1),u=e.slice(o).map(c),d=e.invert().map(l,-1),p=e.invert().map(u);r.push({oldRange:{from:d,to:p},newRange:{from:l,to:u}})})}),Qn(r)}function vt(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(s=>{const o=n.resolve(t),i=kt(o,s.type);i&&r.push({mark:s,...i})}):n.nodesBetween(t,e,(s,o)=>{!s||s?.nodeSize===void 0||r.push(...s.marks.map(i=>({from:o,to:o+s.nodeSize,mark:i})))}),r}function Z(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const s=t.find(o=>o.type===e&&o.name===r);return s?s.attribute.keepOnSplit:!1}))}function ft(t,e,n={}){const{empty:r,ranges:s}=t.selection,o=e?R(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(d=>o?o.name===d.type.name:!0).find(d=>tt(d.attrs,n,{strict:!1}));let i=0;const a=[];if(s.forEach(({$from:d,$to:p})=>{const f=d.pos,m=p.pos;t.doc.nodesBetween(f,m,(h,g)=>{if(!h.isText&&!h.marks.length)return;const y=Math.max(f,g),M=Math.min(m,g+h.nodeSize),v=M-y;i+=v,a.push(...h.marks.map(S=>({mark:S,from:y,to:M})))})}),i===0)return!1;const c=a.filter(d=>o?o.name===d.mark.type.name:!0).filter(d=>tt(d.mark.attrs,n,{strict:!1})).reduce((d,p)=>d+p.to-p.from,0),l=a.filter(d=>o?d.mark.type!==o&&d.mark.type.excludes(o):!0).reduce((d,p)=>d+p.to-p.from,0);return(c>0?c+l:c)>=i}function tr(t,e,n={}){if(!e)return U(t,null,n)||ft(t,null,n);const r=it(e,t.schema);return r==="node"?U(t,e,n):r==="mark"?ft(t,e,n):!1}function Ot(t,e){const{nodeExtensions:n}=rt(e),r=n.find(i=>i.name===t);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},o=b(k(r,"group",s));return typeof o!="string"?!1:o.split(" ").includes("list")}function wt(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!==null&&r!==void 0?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let s=!0;return t.content.forEach(o=>{s!==!1&&(wt(o,{ignoreWhitespace:n,checkChildren:e})||(s=!1))}),s}return!1}function er(t){return t instanceof q}function nr(t,e,n){var r;const{selection:s}=e;let o=null;if(Ut(s)&&(o=s.$cursor),o){const a=(r=t.storedMarks)!==null&&r!==void 0?r:o.marks();return!!n.isInSet(a)||!a.some(c=>c.type.excludes(n))}const{ranges:i}=s;return i.some(({$from:a,$to:c})=>{let l=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,c.pos,(u,d,p)=>{if(l)return!1;if(u.isInline){const f=!p||p.type.allowsMarkType(n),m=!!n.isInSet(u.marks)||!u.marks.some(h=>h.type.excludes(n));l=f&&m}return!l}),l})}const rr=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const{selection:o}=n,{empty:i,ranges:a}=o,c=R(t,r.schema);if(s)if(i){const l=Jt(r,c);n.addStoredMark(c.create({...l,...e}))}else a.forEach(l=>{const u=l.$from.pos,d=l.$to.pos;r.doc.nodesBetween(u,d,(p,f)=>{const m=Math.max(f,u),h=Math.min(f+p.nodeSize,d);p.marks.find(y=>y.type===c)?p.marks.forEach(y=>{c===y.type&&n.addMark(m,h,c.create({...y.attrs,...e}))}):n.addMark(m,h,c.create(e))})});return nr(r,n,c)},sr=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),or=(t,e={})=>({state:n,dispatch:r,chain:s})=>{const o=x(t,n.schema);let i;return n.selection.$anchor.sameParent(n.selection.$head)&&(i=n.selection.$anchor.parent.attrs),o.isTextblock?s().command(({commands:a})=>xt(o,{...i,...e})(n)?!0:a.clearNodes()).command(({state:a})=>xt(o,{...i,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},ir=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,s=_(t,0,r.content.size),o=q.create(r,s);e.setSelection(o)}return!0},ar=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:s,to:o}=typeof t=="number"?{from:t,to:t}:t,i=C.atStart(r).from,a=C.atEnd(r).to,c=_(s,i,a),l=_(o,i,a),u=C.create(r,c,l);e.setSelection(u)}return!0},cr=t=>({state:e,dispatch:n})=>{const r=x(t,e.schema);return ce(r)(e,n)};function $t(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(s=>e?.includes(s.type.name));t.tr.ensureMarks(r)}}const lr=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:s})=>{const{selection:o,doc:i}=e,{$from:a,$to:c}=o,l=s.extensionManager.attributes,u=Z(l,a.node().type.name,a.node().attrs);if(o instanceof q&&o.node.isBlock)return!a.parentOffset||!Q(i,a.pos)?!1:(r&&(t&&$t(n,s.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=c.parentOffset===c.parent.content.size,p=a.depth===0?void 0:Vn(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&p?[{type:p,attrs:u}]:void 0,m=Q(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!m&&Q(e.doc,e.mapping.map(a.pos),1,p?[{type:p}]:void 0)&&(m=!0,f=p?[{type:p,attrs:u}]:void 0),r){if(m&&(o instanceof C&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),p&&!d&&!a.parentOffset&&a.parent.type!==p)){const h=e.mapping.map(a.before()),g=e.doc.resolve(h);a.node(-1).canReplaceWith(g.index(),g.index()+1,p)&&e.setNodeMarkup(e.mapping.map(a.before()),p)}t&&$t(n,s.extensionManager.splittableMarks),e.scrollIntoView()}return m},dr=(t,e={})=>({tr:n,state:r,dispatch:s,editor:o})=>{var i;const a=x(t,r.schema),{$from:c,$to:l}=r.selection,u=r.selection.node;if(u&&u.isBlock||c.depth<2||!c.sameParent(l))return!1;const d=c.node(-1);if(d.type!==a)return!1;const p=o.extensionManager.attributes;if(c.parent.content.size===0&&c.node(-1).childCount===c.indexAfter(-1)){if(c.depth===2||c.node(-3).type!==a||c.index(-2)!==c.node(-2).childCount-1)return!1;if(s){let y=H.empty;const M=c.index(-1)?1:c.index(-2)?2:3;for(let B=c.depth-M;B>=c.depth-3;B-=1)y=H.from(c.node(B).copy(y));const v=c.indexAfter(-1)<c.node(-2).childCount?1:c.indexAfter(-2)<c.node(-3).childCount?2:3,S={...Z(p,c.node().type.name,c.node().attrs),...e},w=((i=a.contentMatch.defaultType)===null||i===void 0?void 0:i.createAndFill(S))||void 0;y=y.append(H.from(a.createAndFill(null,w)||void 0));const E=c.before(c.depth-(M-1));n.replace(E,c.after(-v),new ae(y,4-M,0));let I=-1;n.doc.nodesBetween(E,n.doc.content.size,(B,Yt)=>{if(I>-1)return!1;B.isTextblock&&B.content.size===0&&(I=Yt+1)}),I>-1&&n.setSelection(C.near(n.doc.resolve(I))),n.scrollIntoView()}return!0}const f=l.pos===c.end()?d.contentMatchAt(0).defaultType:null,m={...Z(p,d.type.name,d.attrs),...e},h={...Z(p,c.node().type.name,c.node().attrs),...e};n.delete(c.pos,l.pos);const g=f?[{type:a,attrs:m},{type:f,attrs:h}]:[{type:a,attrs:m}];if(!Q(n.doc,c.pos,2))return!1;if(s){const{selection:y,storedMarks:M}=r,{splittableMarks:v}=o.extensionManager,S=M||y.$to.parentOffset&&y.$from.marks();if(n.split(c.pos,2,g).scrollIntoView(),!S||!s)return!0;const w=S.filter(E=>v.includes(E.type.name));n.ensureMarks(w)}return!0},lt=(t,e)=>{const n=Mt(i=>i.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===s?.type&&mt(t.doc,n.pos)&&t.join(n.pos),!0},dt=(t,e)=>{const n=Mt(i=>i.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===s?.type&&mt(t.doc,r)&&t.join(r),!0},ur=(t,e,n,r={})=>({editor:s,tr:o,state:i,dispatch:a,chain:c,commands:l,can:u})=>{const{extensions:d,splittableMarks:p}=s.extensionManager,f=x(t,i.schema),m=x(e,i.schema),{selection:h,storedMarks:g}=i,{$from:y,$to:M}=h,v=y.blockRange(M),S=g||h.$to.parentOffset&&h.$from.marks();if(!v)return!1;const w=Mt(E=>Ot(E.type.name,d))(h);if(v.depth>=1&&w&&v.depth-w.depth<=1){if(w.node.type===f)return l.liftListItem(m);if(Ot(w.node.type.name,d)&&f.validContent(w.node.content)&&a)return c().command(()=>(o.setNodeMarkup(w.pos,f),!0)).command(()=>lt(o,f)).command(()=>dt(o,f)).run()}return!n||!S||!a?c().command(()=>u().wrapInList(f,r)?!0:l.clearNodes()).wrapInList(f,r).command(()=>lt(o,f)).command(()=>dt(o,f)).run():c().command(()=>{const E=u().wrapInList(f,r),I=S.filter(B=>p.includes(B.type.name));return o.ensureMarks(I),E?!0:l.clearNodes()}).wrapInList(f,r).command(()=>lt(o,f)).command(()=>dt(o,f)).run()},pr=(t,e={},n={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:o=!1}=n,i=R(t,r.schema);return ft(r,i,e)?s.unsetMark(i,{extendEmptyMarkRange:o}):s.setMark(i,e)},fr=(t,e,n={})=>({state:r,commands:s})=>{const o=x(t,r.schema),i=x(e,r.schema),a=U(r,o,n);let c;return r.selection.$anchor.sameParent(r.selection.$head)&&(c=r.selection.$anchor.parent.attrs),a?s.setNode(i,c):s.setNode(o,{...c,...n})},hr=(t,e={})=>({state:n,commands:r})=>{const s=x(t,n.schema);return U(n,s,e)?r.lift(s):r.wrapIn(s,e)},mr=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const s=n[r];let o;if(s.spec.isInputRules&&(o=s.getState(t))){if(e){const i=t.tr,a=o.transform;for(let c=a.steps.length-1;c>=0;c-=1)i.step(a.steps[c].invert(a.docs[c]));if(o.text){const c=i.doc.resolve(o.from).marks();i.replaceWith(o.from,o.to,t.schema.text(o.text,c))}else i.delete(o.from,o.to)}return!0}}return!1},gr=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:s}=n;return r||e&&s.forEach(o=>{t.removeMark(o.$from.pos,o.$to.pos)}),!0},yr=(t,e={})=>({tr:n,state:r,dispatch:s})=>{var o;const{extendEmptyMarkRange:i=!1}=e,{selection:a}=n,c=R(t,r.schema),{$from:l,empty:u,ranges:d}=a;if(!s)return!0;if(u&&i){let{from:p,to:f}=a;const m=(o=l.marks().find(g=>g.type===c))===null||o===void 0?void 0:o.attrs,h=kt(l,c,m);h&&(p=h.from,f=h.to),n.removeMark(p,f,c)}else d.forEach(p=>{n.removeMark(p.$from.pos,p.$to.pos,c)});return n.removeStoredMark(c),!0},kr=(t,e={})=>({tr:n,state:r,dispatch:s})=>{let o=null,i=null;const a=it(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(o=x(t,r.schema)),a==="mark"&&(i=R(t,r.schema)),s&&n.selection.ranges.forEach(c=>{const l=c.$from.pos,u=c.$to.pos;let d,p,f,m;n.selection.empty?r.doc.nodesBetween(l,u,(h,g)=>{o&&o===h.type&&(f=Math.max(g,l),m=Math.min(g+h.nodeSize,u),d=g,p=h)}):r.doc.nodesBetween(l,u,(h,g)=>{g<l&&o&&o===h.type&&(f=Math.max(g,l),m=Math.min(g+h.nodeSize,u),d=g,p=h),g>=l&&g<=u&&(o&&o===h.type&&n.setNodeMarkup(g,void 0,{...h.attrs,...e}),i&&h.marks.length&&h.marks.forEach(y=>{if(i===y.type){const M=Math.max(g,l),v=Math.min(g+h.nodeSize,u);n.addMark(M,v,i.create({...y.attrs,...e}))}}))}),p&&(d!==void 0&&n.setNodeMarkup(d,void 0,{...p.attrs,...e}),i&&p.marks.length&&p.marks.forEach(h=>{i===h.type&&n.addMark(f,m,i.create({...h.attrs,...e}))}))}),!0):!1},br=(t,e={})=>({state:n,dispatch:r})=>{const s=x(t,n.schema);return ie(s,e)(n,r)},Mr=(t,e={})=>({state:n,dispatch:r})=>{const s=x(t,n.schema);return oe(s,e)(n,r)};var vr=Object.freeze({__proto__:null,blur:tn,clearContent:en,clearNodes:nn,command:rn,createParagraphNear:sn,cut:on,deleteCurrentNode:an,deleteNode:cn,deleteRange:ln,deleteSelection:dn,enter:un,exitCode:pn,extendMarkRange:fn,first:hn,focus:gn,forEach:yn,insertContent:kn,insertContentAt:vn,joinBackward:xn,joinDown:An,joinForward:Sn,joinItemBackward:Tn,joinItemForward:En,joinTextblockBackward:Cn,joinTextblockForward:Pn,joinUp:wn,keyboardShortcut:On,lift:$n,liftEmptyBlock:In,liftListItem:Bn,newlineInCode:Hn,resetAttributes:Nn,scrollIntoView:Rn,selectAll:jn,selectNodeBackward:Dn,selectNodeForward:_n,selectParentNode:Fn,selectTextblockEnd:zn,selectTextblockStart:Wn,setContent:Kn,setMark:rr,setMeta:sr,setNode:or,setNodeSelection:ir,setTextSelection:ar,sinkListItem:cr,splitBlock:lr,splitListItem:dr,toggleList:ur,toggleMark:pr,toggleNode:fr,toggleWrap:hr,undoInputRule:mr,unsetAllMarks:gr,unsetMark:yr,updateAttributes:kr,wrapIn:br,wrapInList:Mr});const wr=T.create({name:"commands",addCommands(){return{...vr}}}),Ar=T.create({name:"drop",addProseMirrorPlugins(){return[new L({key:new $("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),xr=T.create({name:"editable",addProseMirrorPlugins(){return[new L({key:new $("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Sr=new $("focusEvents"),Tr=T.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new L({key:Sr,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),Er=T.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:i})=>[()=>i.undoInputRule(),()=>i.command(({tr:a})=>{const{selection:c,doc:l}=a,{empty:u,$anchor:d}=c,{pos:p,parent:f}=d,m=d.parent.isTextblock&&p>0?a.doc.resolve(p-1):d,h=m.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=h&&m.parent.childCount===1?g===d.pos:F.atStart(l).from===p;return!u||!f.type.isTextblock||f.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:i.clearNodes()}),()=>i.deleteSelection(),()=>i.joinBackward(),()=>i.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:i})=>[()=>i.deleteSelection(),()=>i.deleteCurrentNode(),()=>i.joinForward(),()=>i.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:i})=>[()=>i.newlineInCode(),()=>i.createParagraphNear(),()=>i.liftEmptyBlock(),()=>i.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},o={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return bt()||Gt()?o:s},addProseMirrorPlugins(){return[new L({key:new $("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(h=>h.getMeta("composition")))return;const r=t.some(h=>h.docChanged)&&!e.doc.eq(n.doc),s=t.some(h=>h.getMeta("preventClearDocument"));if(!r||s)return;const{empty:o,from:i,to:a}=e.selection,c=F.atStart(e.doc).from,l=F.atEnd(e.doc).to;if(o||!(i===c&&a===l)||!wt(n.doc))return;const p=n.tr,f=et({state:n,transaction:p}),{commands:m}=new nt({editor:this.editor,state:f});if(m.clearNodes(),!!p.steps.length)return p}})]}}),Cr=T.create({name:"paste",addProseMirrorPlugins(){return[new L({key:new $("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),Pr=T.create({name:"tabindex",addProseMirrorPlugins(){return[new L({key:new $("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class D{get name(){return this.node.type.name}constructor(e,n,r=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=s}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can’t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new D(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new D(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new D(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const s=n.isBlock&&!n.isTextblock,o=n.isAtom&&!n.isText,i=this.pos+r+(o?0:1);if(i<0||i>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(i);if(!s&&a.depth<=this.depth)return;const c=new D(a,this.editor,s,s?n:null);s&&(c.actualDepth=this.depth+1),e.push(new D(a,this.editor,s,s?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,s=this.parent;for(;s&&!r;){if(s.node.type.name===e)if(Object.keys(n).length>0){const o=s.node.attrs,i=Object.keys(n);for(let a=0;a<i.length;a+=1){const c=i[a];if(o[c]!==n[c])break}}else r=s;s=s.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let s=[];if(!this.children||this.children.length===0)return s;const o=Object.keys(n);return this.children.forEach(i=>{r&&s.length>0||(i.node.type.name===e&&o.every(c=>n[c]===i.node.attrs[c])&&s.push(i),!(r&&s.length>0)&&(s=s.concat(i.querySelectorAll(e,n,r))))}),s}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}}const Lr=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function Or(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute("data-tiptap-style",""),s.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(s),s}let Ts=class extends je{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:r,moved:s})=>this.options.onDrop(n,r,s)),this.on("paste",({event:n,slice:r})=>this.options.onPaste(n,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=Or(Lr,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const r=Ft(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(o=>{const i=typeof o=="string"?`${o}$`:o.key;r=r.filter(a=>!a.key.startsWith(i))}),n.length===r.length)return;const s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}createExtensionManager(){var e,n;const s=[...this.options.enableCoreExtensions?[xr,Ze.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),wr,Tr,Er,Pr,Ar,Cr].filter(o=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[o.name]!==!1:!0):[],...this.options.extensions].filter(o=>["extension","node","mark"].includes(o?.type));this.extensionManager=new W(s,this)}createCommandManager(){this.commandManager=new nt({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let n;try{n=pt(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(i){if(!(i instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(i.message))throw i;this.emit("contentError",{editor:this,error:i,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>a.name!=="collaboration"),this.createExtensionManager()}}),n=pt(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=Vt(n,this.options.autofocus);this.view=new Zt(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:te.create({doc:n,selection:r||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();const o=this.view.dom;o.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(i=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(i)});return}const n=this.state.apply(e),r=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const s=e.getMeta("focus"),o=e.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:e}),o&&this.emit("blur",{editor:this,event:o.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return Xt(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,s=typeof e=="string"?n:e;return tr(this.state,r,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return gt(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return Jn(this.state.doc,{blockSeparator:n,textSerializers:{...Wt(this.schema),...r}})}get isEmpty(){return wt(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new D(n,this)}get $doc(){return this.$pos(0)}};function z(t){return new st({find:t.find,handler:({state:e,range:n,match:r})=>{const s=b(t.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:o}=e,i=r[r.length-1],a=r[0];if(i){const c=a.search(/\S/),l=n.from+a.indexOf(i),u=l+i.length;if(vt(n.from,n.to,e.doc).filter(f=>f.mark.type.excluded.find(h=>h===t.type&&h!==f.mark.type)).filter(f=>f.to>l).length)return null;u<n.to&&o.delete(u,n.to),l>n.from&&o.delete(n.from+c,l);const p=n.from+c+i.length;o.addMark(n.from+c,p,t.type.create(s||{})),o.removeStoredMark(t.type)}}})}function $r(t){return new st({find:t.find,handler:({state:e,range:n,match:r})=>{const s=b(t.getAttributes,void 0,r)||{},{tr:o}=e,i=n.from;let a=n.to;const c=t.type.create(s);if(r[1]){const l=r[0].lastIndexOf(r[1]);let u=i+l;u>a?u=a:a=u+r[1].length;const d=r[0][r[0].length-1];o.insertText(d,i+r[0].length-1),o.replaceWith(u,a,c)}else if(r[0]){const l=t.type.isInline?i:i-1;o.insert(l,t.type.create(s)).delete(o.mapping.map(i),o.mapping.map(a))}o.scrollIntoView()}})}function ht(t){return new st({find:t.find,handler:({state:e,range:n,match:r})=>{const s=e.doc.resolve(n.from),o=b(t.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,o)}})}function V(t){return new st({find:t.find,handler:({state:e,range:n,match:r,chain:s})=>{const o=b(t.getAttributes,void 0,r)||{},i=e.tr.delete(n.from,n.to),c=i.doc.resolve(n.from).blockRange(),l=c&&Qt(c,t.type,o);if(!l)return null;if(i.wrap(c,l),t.keepMarks&&t.editor){const{selection:d,storedMarks:p}=e,{splittableMarks:f}=t.editor.extensionManager,m=p||d.$to.parentOffset&&d.$from.marks();if(m){const h=m.filter(g=>f.includes(g.type.name));i.ensureMarks(h)}}if(t.keepAttributes){const d=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(d,o).run()}const u=i.doc.resolve(n.from-1).nodeBefore;u&&u.type===t.type&&mt(i.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,u))&&i.join(n.from-1)}})}class P{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=b(k(this,"addOptions",{name:this.name}))),this.storage=b(k(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new P(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>ot(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new P(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=b(k(n,"addOptions",{name:n.name})),n.storage=b(k(n,"addStorage",{name:n.name,options:n.options})),n}}function N(t){return new qe({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:s})=>{const o=b(t.getAttributes,void 0,r,s);if(o===!1||o===null)return null;const{tr:i}=e,a=r[r.length-1],c=r[0];let l=n.to;if(a){const u=c.search(/\S/),d=n.from+c.indexOf(a),p=d+a.length;if(vt(n.from,n.to,e.doc).filter(m=>m.mark.type.excluded.find(g=>g===t.type&&g!==m.mark.type)).filter(m=>m.to>d).length)return null;p<n.to&&i.delete(p,n.to),d>n.from&&i.delete(n.from+u,d),l=n.from+u+a.length,i.addMark(n.from+u,l,t.type.create(o||{})),i.removeStoredMark(t.type)}}})}function Ir(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof q){const o=r.index();return r.parent.canReplaceWith(o,o+1,e)}let s=r.depth;for(;s>=0;){const o=r.index(s);if(r.node(s).contentMatchAt(o).matchType(e))return!0;s-=1}return!1}const Br=/^\s*>\s$/,Hr=P.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",A(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[V({find:Br,type:this.type})]}}),Nr=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Rr=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,jr=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Dr=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,_r=O.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",A(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[z({find:Nr,type:this.type}),z({find:jr,type:this.type})]},addPasteRules(){return[N({find:Rr,type:this.type}),N({find:Dr,type:this.type})]}}),Fr="listItem",It="textStyle",Bt=/^\s*([-+*])\s$/,zr=P.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",A(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Fr,this.editor.getAttributes(It)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=V({find:Bt,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=V({find:Bt,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(It),editor:this.editor})),[t]}}),Wr=/(^|[^`])`([^`]+)`(?!`)/,Kr=/(^|[^`])`([^`]+)`(?!`)/g,Ur=O.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",A(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[z({find:Wr,type:this.type})]},addPasteRules(){return[N({find:Kr,type:this.type})]}}),Vr=/^```([a-z]+)?[\s\n]$/,qr=/^~~~([a-z]+)?[\s\n]$/,Gr=P.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,o=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(i=>i.startsWith(n)).map(i=>i.replace(n,""))[0];return o||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",A(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;const o=r.parentOffset===r.parent.nodeSize-2,i=r.parent.textContent.endsWith(`

`);return!o||!i?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:s,empty:o}=n;if(!o||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const a=s.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:l})=>(l.setSelection(F.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[ht({find:Vr,type:this.type,getAttributes:t=>({language:t[1]})}),ht({find:qr,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new L({key:new $("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,o=s?.mode;if(!n||!o)return!1;const{tr:i,schema:a}=t.state,c=a.text(n.replace(/\r\n?/g,`
`));return i.replaceSelectionWith(this.type.create({language:o},c)),i.selection.$from.parent.type!==this.type&&i.setSelection(C.near(i.doc.resolve(Math.max(0,i.selection.from-2)))),i.setMeta("paste",!0),t.dispatch(i),!0}}})]}}),Jr=P.create({name:"doc",topNode:!0,content:"block+"}),Xr=T.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Oe(this.options)]}}),Yr=T.create({name:"gapCursor",addProseMirrorPlugins(){return[$e()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=b(k(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),Qr=P.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",A(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:s,storedMarks:o}=n;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:i}=this.options,{splittableMarks:a}=r.extensionManager,c=o||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:l,dispatch:u})=>{if(u&&c&&i){const d=c.filter(p=>a.includes(p.type.name));l.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Zr=P.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,A(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>ht({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),ts=T.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>He(t,e),redo:()=>({state:t,dispatch:e})=>Be(t,e)}},addProseMirrorPlugins(){return[Ie(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),es=P.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",A(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!Ir(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$from:r,$to:s}=n,o=t();return r.parentOffset===0?o.insertContentAt({from:Math.max(r.pos-1,0),to:s.pos},{type:this.name}):er(n)?o.insertContentAt(s.pos,{type:this.name}):o.insertContent({type:this.name}),o.command(({tr:i,dispatch:a})=>{var c;if(a){const{$to:l}=i.selection,u=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?i.setSelection(C.create(i.doc,l.pos+1)):l.nodeAfter.isBlock?i.setSelection(q.create(i.doc,l.pos)):i.setSelection(C.create(i.doc,l.pos));else{const d=(c=l.parent.type.contentMatch.defaultType)===null||c===void 0?void 0:c.create();d&&(i.insert(u,d),i.setSelection(C.create(i.doc,u+1)))}i.scrollIntoView()}return!0}).run()}}},addInputRules(){return[$r({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),ns=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,rs=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,ss=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,os=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,is=O.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",A(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[z({find:ns,type:this.type}),z({find:ss,type:this.type})]},addPasteRules(){return[N({find:rs,type:this.type}),N({find:os,type:this.type})]}}),as=P.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",A(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),cs="listItem",Ht="textStyle",Nt=/^(\d+)\.\s$/,ls=P.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",A(this.options.HTMLAttributes,n),0]:["ol",A(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(cs,this.editor.getAttributes(Ht)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=V({find:Nt,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=V({find:Nt,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(Ht)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),ds=P.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",A(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),us=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,ps=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,fs=O.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",A(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[z({find:us,type:this.type})]},addPasteRules(){return[N({find:ps,type:this.type})]}}),hs=P.create({name:"text",group:"inline"}),Cs=T.create({name:"starterKit",addExtensions(){const t=[];return this.options.bold!==!1&&t.push(_r.configure(this.options.bold)),this.options.blockquote!==!1&&t.push(Hr.configure(this.options.blockquote)),this.options.bulletList!==!1&&t.push(zr.configure(this.options.bulletList)),this.options.code!==!1&&t.push(Ur.configure(this.options.code)),this.options.codeBlock!==!1&&t.push(Gr.configure(this.options.codeBlock)),this.options.document!==!1&&t.push(Jr.configure(this.options.document)),this.options.dropcursor!==!1&&t.push(Xr.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&t.push(Yr.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&t.push(Qr.configure(this.options.hardBreak)),this.options.heading!==!1&&t.push(Zr.configure(this.options.heading)),this.options.history!==!1&&t.push(ts.configure(this.options.history)),this.options.horizontalRule!==!1&&t.push(es.configure(this.options.horizontalRule)),this.options.italic!==!1&&t.push(is.configure(this.options.italic)),this.options.listItem!==!1&&t.push(as.configure(this.options.listItem)),this.options.orderedList!==!1&&t.push(ls.configure(this.options.orderedList)),this.options.paragraph!==!1&&t.push(ds.configure(this.options.paragraph)),this.options.strike!==!1&&t.push(fs.configure(this.options.strike)),this.options.text!==!1&&t.push(hs.configure(this.options.text)),t}}),ms=t=>{if(!t.children.length)return;const e=t.querySelectorAll("span");e&&e.forEach(n=>{var r,s;const o=n.getAttribute("style"),i=(s=(r=n.parentElement)===null||r===void 0?void 0:r.closest("span"))===null||s===void 0?void 0:s.getAttribute("style");n.setAttribute("style",`${i};${o}`)})},Ps=O.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!1}},parseHTML(){return[{tag:"span",getAttrs:t=>t.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&ms(t),{}):!1}]},renderHTML({HTMLAttributes:t}){return["span",A(this.options.HTMLAttributes,t),0]},addCommands(){return{removeEmptyTextStyle:()=>({tr:t})=>{const{selection:e}=t;return t.doc.nodesBetween(e.from,e.to,(n,r)=>{if(n.isTextblock)return!0;n.marks.filter(s=>s.type===this.type).some(s=>Object.values(s.attrs).some(o=>!!o))||t.removeMark(r,r+n.nodeSize,this.type)}),!0}}}}),Ls=T.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:t=>{var e;return(e=t.style.color)===null||e===void 0?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.color?{style:`color: ${t.color}`}:{}}}}]},addCommands(){return{setColor:t=>({chain:e})=>e().setMark("textStyle",{color:t}).run(),unsetColor:()=>({chain:t})=>t().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),gs=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,ys=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,Os=O.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",A(this.options.HTMLAttributes,t),0]},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[z({find:gs,type:this.type})]},addPasteRules(){return[N({find:ys,type:this.type})]}}),$s=T.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:null}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:t=>{const e=t.style.textAlign;return this.options.alignments.includes(e)?e:this.options.defaultAlignment},renderHTML:t=>t.textAlign?{style:`text-align: ${t.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:t=>({commands:e})=>this.options.alignments.includes(t)?this.options.types.map(n=>e.updateAttributes(n,{textAlign:t})).every(n=>n):!1,unsetTextAlign:()=>({commands:t})=>this.options.types.map(e=>t.resetAttributes(e,"textAlign")).every(e=>e),toggleTextAlign:t=>({editor:e,commands:n})=>this.options.alignments.includes(t)?e.isActive({textAlign:t})?n.unsetTextAlign():n.setTextAlign(t):!1}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}}),Is=O.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",A(this.options.HTMLAttributes,t),0]},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),At="[\0-   ᠎ -\u2029 　]",ks=new RegExp(At),bs=new RegExp(`${At}$`),Ms=new RegExp(At,"g");function vs(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function ws(t){return new L({key:new $("autolink"),appendTransaction:(e,n,r)=>{const s=e.some(l=>l.docChanged)&&!n.doc.eq(r.doc),o=e.some(l=>l.getMeta("preventAutolink"));if(!s||o)return;const{tr:i}=r,a=Un(n.doc,[...e]);if(Zn(a).forEach(({newRange:l})=>{const u=qn(r.doc,l,f=>f.isTextblock);let d,p;if(u.length>1)d=u[0],p=r.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ");else if(u.length){const f=r.doc.textBetween(l.from,l.to," "," ");if(!bs.test(f))return;d=u[0],p=r.doc.textBetween(d.pos,l.to,void 0," ")}if(d&&p){const f=p.split(ks).filter(Boolean);if(f.length<=0)return!1;const m=f[f.length-1],h=d.pos+p.lastIndexOf(m);if(!m)return!1;const g=Ne(m).map(y=>y.toObject(t.defaultProtocol));if(!vs(g))return!1;g.filter(y=>y.isLink).map(y=>({...y,from:h+y.start+1,to:h+y.end+1})).filter(y=>r.schema.marks.code?!r.doc.rangeHasMark(y.from,y.to,r.schema.marks.code):!0).filter(y=>t.validate(y.value)).filter(y=>t.shouldAutoLink(y.value)).forEach(y=>{vt(y.from,y.to,r.doc).some(M=>M.mark.type===t.type)||i.addMark(y.from,y.to,t.type.create({href:y.href}))})}}),!!i.steps.length)return i}})}function As(t){return new L({key:new $("handleClickLink"),props:{handleClick:(e,n,r)=>{var s,o;if(r.button!==0||!e.editable)return!1;let i=r.target;const a=[];for(;i.nodeName!=="DIV";)a.push(i),i=i.parentNode;if(!a.find(p=>p.nodeName==="A"))return!1;const c=Xt(e.state,t.type.name),l=r.target,u=(s=l?.href)!==null&&s!==void 0?s:c.href,d=(o=l?.target)!==null&&o!==void 0?o:c.target;return l&&u?(window.open(u,d),!0):!1}}})}function xs(t){return new L({key:new $("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{state:s}=e,{selection:o}=s,{empty:i}=o;if(i)return!1;let a="";r.content.forEach(l=>{a+=l.textContent});const c=Dt(a,{defaultProtocol:t.defaultProtocol}).find(l=>l.isLink&&l.value===a);return!a||!c?!1:t.editor.commands.setMark(t.type,{href:c.href})}}})}function j(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const s=typeof r=="string"?r:r.scheme;s&&n.push(s)}),!t||t.replace(Ms,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}const Bs=O.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){St(t);return}St(t.scheme,t.optionalSlashes)})},onDestroy(){Re()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!j(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>!!t}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!j(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!j(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",A(this.options.HTMLAttributes,t),0]:["a",A(this.options.HTMLAttributes,{...t,href:""}),0]},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!j(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!j(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run():!1},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[N({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,s=Dt(t).filter(o=>o.isLink&&this.options.isAllowedUri(o.value,{defaultValidate:i=>!!j(i,n),protocols:n,defaultProtocol:r}));s.length&&s.forEach(o=>e.push({text:o.value,data:{href:o.href},index:o.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(ws({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:s=>!!j(s,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&t.push(As({type:this.type})),this.options.linkOnPaste&&t.push(xs({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),t}});export{Hr as B,Ls as C,Ts as E,Os as H,Bs as L,P as N,Cs as S,Ps as T,Is as U,$s as a,Ur as b,Gr as c};
